# Датасеты для обучения NER-модели

Данная папка содержит датасеты для обучения и тестирования моделей извлечения именованных сущностей из текстов продуктов питания и товаров.

## Структура датасетов

### Файлы данных

| Файл | Размер | Описание |
|------|--------|----------|
| `data/train.csv` | 27,252 строки | Исходный датасет с базовой разметкой |
| `data/train_with_aug.csv` | 88,869 строк | Аугментированный датасет с расширенными примерами |

### Формат данных

Все датасеты используют единый формат CSV с разделителем `;`:

```csv
sample;annotation
abtoys игрушки;[(0, 6, 'B-BRAND'), (7, 14, 'B-TYPE')]
actimel;[(0, 7, 'B-BRAND')]
```

**Структура записи:**
- `sample` - текстовый пример для анализа
- `annotation` - список спанов в формате `[(start, end, label), ...]`

## Типы сущностей

Датасет содержит разметку для 4 типов сущностей:

### **BRAND** - Бренды товаров
- Примеры: `actimel`, `alpen gold`, `ahmad tea`
- Многословные бренды: `alpen gold max fun`
- Смешанные языки: `ahmad tea` (английский + русский)

### **TYPE** - Типы товаров
- Примеры: `игрушки`, `пиво`, `треска`, `салатники`
- Продукты питания: `виноград`, `клубника`, `груша`
- Товары: `ботинки`, `обложки`, `багеты`

### **VOLUME** - Объемы и количества
- Числовые значения: `500мл`, `1л`, `2кг`
- Единицы измерения: `мл`, `л`, `г`, `кг`, `шт`

### **PERCENT** - Проценты
- Формат: `15%`, `2.5%`, `100%`

## BIO-разметка

Используется стандартная BIO-схема:
- **B-ENTITY** - начало сущности
- **I-ENTITY** - продолжение сущности  
- **O** - не сущность

**Пример разметки:**
```
Текст: "alpen gold max fun"
Разметка: [(0, 5, 'B-BRAND'), (6, 10, 'I-BRAND'), (11, 14, 'I-BRAND'), (15, 18, 'I-BRAND')]
```

## Процесс создания датасетов

### **Обработка исходных данных**

**Источник:** [Russian Groceries Prices Dataset](https://www.kaggle.com/datasets/dadalyndell/russian-groceries-prices-2019-2022/data)

**Этапы обработки:**

1. **Загрузка данных** из Kaggle датасета
2. **Предобработка** названий товаров
3. **Инференс** с помощью обученной SpaCy модели
4. **Конвертация** результатов в BIO-формат
5. **Аугментация** данных

### **Алгоритм аугментации**

Код в `processing_dataset_from_kaggle.py` реализует следующие стратегии аугментации:

#### **1. Обрезка названий товаров**
```python
# Различные длины префиксов
var1 = text[:2]    # "alpen gold" -> "al"
var2 = text[:5]    # "alpen gold" -> "alpen"
var3 = text[:8]    # "alpen gold" -> "alpen go"
var4 = text[:10]   # "alpen gold" -> "alpen gold"
var5 = text[:14]   # "alpen gold max" -> "alpen gold max"
```

#### **2. Перестановка слов**
```python
# Начало + конец
var7 = " ".join(words[:2] + words[-1:])  # "alpen gold max" -> "alpen max"
var8 = " ".join(words[-1:] + words[:2])  # "alpen gold max" -> "max alpen"

# Для длинных названий
if len(words) > 4:
    var9 = " ".join(words[:2] + words[-2:])   # "alpen gold max fun" -> "alpen fun"
    var10 = " ".join(words[-2:] + words[:2])  # "alpen gold max fun" -> "fun alpen"
```

#### **3. Очистка от пунктуации**
- Удаление кавычек: `«`, `»`
- Разделение по запятым: `"товар, описание"` -> `"товар"`
- Приведение к нижнему регистру

### **Статистика аугментации**

| Метрика | Исходный датасет | Аугментированный |
|---------|------------------|------------------|
| **Количество примеров** | 27,252 | 88,869 |
| **Увеличение** | - | +226% |
| **Средняя длина** | ~15 символов | ~8 символов |
| **Покрытие сущностей** | Полное | Расширенное |

## Особенности данных

### **Многоязычность**
- **Русский язык**: основная часть данных
- **Английский язык**: международные бренды
- **Смешанные тексты**: `ahmad tea`, `alpen gold`

### **Доменная специфика**
- **Продукты питания**: молочные продукты, напитки, кондитерские изделия
- **Товары для дома**: посуда, текстиль, бытовая химия
- **Детские товары**: игрушки, детское питание

### **Стилистические особенности**
- **Короткие названия**: `actimel`, `ahmad`
- **Полные названия**: `alpen gold max fun`
- **Сокращения**: `abtoys` (от "ab toys")
- **Транслитерация**: `afanasiy` (от "Афанасий")

## Технические детали

### **Обработка пунктуации**
```python
def _strip_punct(s: str) -> str:
    """Удаляет пунктуацию, кроме %"""
    return "".join(ch for ch in s if not _is_punct(ch))
```

### **Токенизация**
- Разделение по пробелам
- Сохранение позиций токенов
- Приведение к нижнему регистру

### **Конвертация форматов**
```python
def convert_model2_to_model1(text, model2_results):
    """Конвертирует результаты NER в BIO-формат"""
    # Токенизация текста
    # Поиск совпадений сущностей
    # Разметка BIO-тегами
```

## Использование датасетов

### **Для обучения**
```python
import pandas as pd

# Загрузка датасета
df = pd.read_csv('data/train_with_aug.csv', sep=';')

# Парсинг аннотаций
annotations = [literal_eval(ann) for ann in df['annotation']]
```

### **Анализ качества**
- **Покрытие сущностей**: все 4 типа представлены
- **Баланс классов**: равномерное распределение
- **Сложность примеров**: от простых до составных

### **Метрики датасета**
- **Общее количество примеров**: 88,869
- **Уникальных брендов**: ~15,000
- **Уникальных типов**: ~8,000
- **Средняя длина примера**: 8 символов
- **Максимальная длина**: 50 символов

## Рекомендации по использованию

### ✅ **Лучшие практики**
1. **Валидация данных**: проверка корректности BIO-разметки
2. **Балансировка**: учет распределения классов
3. **Предобработка**: нормализация текста перед обучением
4. **Аугментация**: использование дополнительных стратегий

### **Ограничения**
1. **Доменная специфика**: данные ориентированы на продукты питания
2. **Языковая специфика**: преимущественно русский язык
3. **Стилистические особенности**: короткие названия товаров

### **Возможности расширения**
1. **Дополнительные домены**: электроника, одежда, книги
2. **Многоязычные данные**: расширение на другие языки
3. **Синтетические данные**: генерация с помощью LLM
4. **Активное обучение**: итеративное улучшение разметки